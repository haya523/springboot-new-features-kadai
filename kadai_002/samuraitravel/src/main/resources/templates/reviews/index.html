<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>レビュー一覧</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<h1>レビュー一覧</h1>

<!-- レビューがない場合 -->
<div th:if="${reviews.totalElements == 0}">
    この民宿にはまだレビューがありません。
</div>

<!-- レビューがある場合 -->
<ul th:if="${reviews.totalElements > 0}">
    <li th:each="r : ${reviews.content}">
        <!-- 星の表示 -->
        <span th:utext="${'&#9733;'.repeat(r.rating)}"></span>
        <span th:utext="${'&#9734;'.repeat(5 - r.rating)}"></span>
         ：<span th:text="${r.comment}">コメント</span>

        <!-- 自分のレビュー行だけ編集/削除 -->
        <span th:if="${myReviewId != null and r.id == myReviewId}" style="margin-left:.5rem">
            <a th:href="@{|/reviews/${r.id}/edit|}">編集</a>
            <form th:action="@{|/reviews/${r.id}/delete|}" method="post" style="display:inline">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button type="submit">削除</button>
            </form>
        </span>
    </li>
</ul>

<!-- ページング -->
<div th:if="${reviews.totalPages > 1}">
    <span th:each="i : ${#numbers.sequence(0, reviews.totalPages - 1)}">
        <a th:if="${i != reviews.number}"
           th:href="@{/reviews/house/{hid}(hid=${houseId}, page=${i})}"
           th:text="${i + 1}">1</a>
        <span th:if="${i == reviews.number}" th:text="${i + 1}">1</span>
    </span>
</div>

<!-- 戻るリンク -->
<div>
    <a th:href="@{/houses/{hid}(hid=${houseId})}">民宿詳細に戻る</a>
</div>

</body>
</html>
