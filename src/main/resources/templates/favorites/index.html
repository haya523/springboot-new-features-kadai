<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8">
  <title>お気に入り一覧 | samuraitravel</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
    .container { max-width: 1080px; margin: 0 auto; padding: 16px; }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .card { border:1px solid #ddd; border-radius:8px; overflow:hidden; background:#fff; }
    .card img { width:100%; height:180px; object-fit:cover; display:block; }
    .card .body { padding: 10px; }
    .btn { display:inline-block; padding:6px 10px; border:1px solid #ccc; border-radius:6px; background:#fafafa; text-decoration:none; cursor:pointer; }
    .btn-primary { background:#eef5ff; border-color:#cddfff; }
    .btn-danger { background:#fff0f0; border-color:#f2b2b2; color:#cc0000; }
    .alert { margin: 12px 0; padding: 10px; background:#eef9f0; border:1px solid #cfe7d4; border-radius:8px; }
    .pager { display:flex; gap:8px; justify-content:center; margin-top:16px; }
    .pager a, .pager span { padding:6px 10px; border:1px solid #ddd; border-radius:6px; text-decoration:none; }
    .pager .active { background:#eee; }
  </style>
</head>
<body>

<header class="container" style="padding-top:12px;">
  <a class="btn" th:href="@{/}">ホーム</a>
  <a class="btn" th:href="@{/houses}">民宿一覧</a>
</header>

<main class="container">
  <h1>お気に入り一覧</h1>

  <div th:if="${successMessage}" class="alert" th:text="${successMessage}"></div>

  <div th:if="${favorites.empty}">
    まだお気に入りはありません。<a th:href="@{/houses}" class="btn btn-primary">民宿を探す</a>
  </div>

  <div class="grid" th:if="${!favorites.empty}">
    <div class="card" th:each="fav : ${favorites}">
      <a th:href="@{|/houses/${fav.house.id}|}">
        <img th:src="${fav.house.mainImageUrl != null ? fav.house.mainImageUrl : '/storage/house01.jpg'}"
             th:alt="${fav.house.name}">
      </a>
      <div class="body">
        <h3 th:text="${fav.house.name}">民宿名</h3>
        <p>
          <span th:text="${fav.house.price}">10000</span> 円/泊
          （<span th:text="${#temporals.format(fav.createdAt, 'yyyy/MM/dd HH:mm')}">2025/01/01</span>に保存）
        </p>
        <div style="display:flex; gap:8px;">
          <a class="btn btn-primary" th:href="@{|/houses/${fav.house.id}|}">詳細を見る</a>
          <form th:action="@{|/favorites/house/${fav.house.id}/remove|}" method="post" style="display:inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <input type="hidden" name="page" th:value="${favorites.number}">
            <button type="submit" class="btn btn-danger">解除</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- ページネーション -->
  <div class="pager" th:if="${favorites.totalPages > 1}">
    <a th:if="${!favorites.first}" th:href="@{|/favorites?page=${favorites.number - 1}|}">＜ 前へ</a>
    <span th:each="i : ${#numbers.sequence(0, favorites.totalPages - 1)}"
          th:classappend="${i == favorites.number} ? 'active'">
      <a th:if="${i != favorites.number}" th:href="@{|/favorites?page=${i}|}" th:text="${i + 1}">1</a>
      <span th:if="${i == favorites.number}" th:text="${i + 1}">1</span>
    </span>
    <a th:if="${!favorites.last}" th:href="@{|/favorites?page=${favorites.number + 1}|}">次へ ＞</a>
  </div>
</main>

</body>
</html>
